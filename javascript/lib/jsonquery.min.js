(function(){function map(arr,fun){var len=arr.length;if(typeof fun!="function")
throw new TypeError();var res=new Array(len);var thisp=arguments[2];for(var i=0;i<len;i++){if(i in arr)
res[i]=fun.call(thisp,arr[i],i,arr);}
return res;}
function filter(arr,fun){var len=arr.length;if(typeof fun!="function")
throw new TypeError();var res=new Array();var thisp=arguments[2];for(var i=0;i<len;i++){if(i in arr){var val=arr[i];if(fun.call(thisp,val,i,arr))
res.push(val);}}
return res;};function slice(obj,start,end,step){var len=obj.length,results=[];end=end||len;start=(start<0)?Math.max(0,start+len):Math.min(len,start);end=(end<0)?Math.max(0,end+len):Math.min(len,end);for(var i=start;i<end;i+=step){results.push(obj[i]);}
return results;}
function expand(obj,name){var results=[];function walk(obj){if(name){if(name===true&&!(obj instanceof Array)){results.push(obj);}else if(obj[name]){results.push(obj[name]);}}
for(var i in obj){var val=obj[i];if(!name){results.push(val);}else if(val&&typeof val=='object'){walk(val);}}}
if(name instanceof Array){if(name.length==1){return obj[name[0]];}
for(var i=0;i<name.length;i++){results.push(obj[name[i]]);}}else{walk(obj);}
return results;}
function distinctFilter(array,callback){var outArr=[];var primitives={};for(var i=0,l=array.length;i<l;++i){var value=array[i];if(callback(value,i,array)){if((typeof value=='object')&&value){if(!value.__included){value.__included=true;outArr.push(value);}}else if(!primitives[value+typeof value]){primitives[value+typeof value]=true;outArr.push(value);}}}
for(i=0,l=outArr.length;i<l;++i){if(outArr[i]){delete outArr[i].__included;}}
return outArr;}
var JSONQuery=function(query,obj){tokens=[];var depth=0;var str=[];query=query.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(t){depth+=t=='['?1:t==']'?-1:0;return(t==']'&&depth>0)?'`]':(t.charAt(0)=='"'||t.charAt(0)=="'")?"`"+(str.push(t)-1):t;});var prefix='';function call(name){prefix=name+"("+prefix;}
function makeRegex(t,a,b,c,d){return str[d].match(/[\*\?]/)||c=='~'?"/^"+str[d].substring(1,str[d].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,".$1")+(c=='~'?'$/i':'$/')+".test("+a+")":t;}
query.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw new Error("Unsafe function call");});query=query.replace(/([^=]=)([^=])/g,"$1=$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(t){return t.charAt(0)=='.'?t:t=='@'?"$obj":(t.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+t;}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(t,a,b){var oper=t.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/);if(oper){var prefix='';if(t.match(/^\./)){call("expand");prefix=",true)";}
call(oper[1].match(/\=/)?"map":oper[1].match(/\^/)?"distinctFilter":"filter");return prefix+",function($obj){return "+oper[2]+"})";}
oper=t.match(/^\[\s*([\/\\].*)\]/);if(oper){return".concat().sort(function(a,b){"+oper[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(t,a,b){return"var av= "+b.replace(/\$obj/,"a")+",bv= "+b.replace(/\$obj/,"b")+";if(av>bv||bv==null){return "+(a=="/"?1:-1)+";}\n"+"if(bv>av||av==null){return "+(a=="/"?-1:1)+";}\n";})+"})";}
oper=t.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/);if(oper){call("slice");return","+(oper[1]||0)+","+(oper[2]||0)+","+(oper[3]||1)+")";}
if(t.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)){call("expand");return(t.charAt(1)=='.'?",'"+b+"'":t.match(/,/)?","+t:"")+")";}
return t;}).replace(/(\$obj\s*(\.\s*[\w_$]+\s*)*)(==|~)\s*`([0-9]+)/g,makeRegex).replace(/`([0-9]+)\s*(==|~)\s*(\$obj(\s*\.\s*[\w_$]+)*)/g,function(t,a,b,c,d){return makeRegex(t,c,d,b,a);});query=prefix+(query.charAt(0)=='$'?"":"$")+query.replace(/`([0-9]+|\])/g,function(t,a){return a==']'?']':str[a];});var executor=eval("1&&function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj=$;return "+query+"}");for(var i=0;i<arguments.length-1;i++){arguments[i]=arguments[i+1];}
return obj?executor.apply(this,arguments):executor;};if(typeof namespace=="function"){namespace("json::JSONQuery",JSONQuery);}
else{window["JSONQuery"]=JSONQuery;}})();

