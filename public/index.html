<!DOCTYPE html>
<html lang="en" manifest="cache-manifest.manifest">
	<head>
		<title>Dominion</title>

		<meta charset="utf-8">
		<meta name="viewport" content="width=devicewidth; 
			initial-scale=1.0; maximum-scale=1; user-scalable=0;">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="default">

		<!-- CSS Files -->
		<link rel="stylesheet" href="css/jquery.mobile-1.0a4.1.min.css" 
			type="text/css" charset="utf-8" media="screen">
		
		<!-- Third Party Library Files -->
		<script src="javascript/lib/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/lib/json2.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/lib/underscore-min.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/lib/backbone-min.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/lib/jsonquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/lib/store.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/lib/qtip.jquery.min.js" type="text/javascript" charset="utf-8"></script>

		<!-- Data Files -->
		<script src="data/defaults.json" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/data.js" type="text/javascript" charset="utf-8"></script>

		<!-- Classes/Libraries -->
		<script src="javascript/model.card.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/collection.library.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/view.options.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/class.config.js" type="text/javascript" charset="utf-8"></script>
		<script src="javascript/class.deck.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript" charset="utf-8">
// If we have a new manifest, swap over to the new data when it's ready.
window.applicationCache.addEventListener('updateready', function() {
	console.log('Update Ready, swapping cache.');
	window.applicationCache.swapCache();
}, false);
// Prevent scrolling for touch move events.
function BlockMove(event) { if( ! $('#ConfigWindow').is(':visible') ) event.preventDefault(); }

var ACTIVE_TIP = false;
var DEBUG_MODE = false;

function showConfigPanel() {
	config.updateConfigWindow();
	$('#ConfigWindow').show();
}
function hideConfigPanel(save) {
	if( Boolean(save) ) config.saveSettings();
	$('#ConfigWindow').hide();
}
function showSets() {
	$('#SetList').empty().append(deck.buildSetListHTML()).show();
	$('#SetWindow').show();
}
function hideSetPanel() {
	$('#SetWindow').hide();
}
function replaceSingleCard(cardLi) {
	deck.replaceCard(cardLi);
	$(cardLi).qtip('hide');
	ACTIVE_TIP = false;
	$('#Deck').empty().append(deck.buildDeckHTML()).show();
}
function generateDeck() {
	$('#Deck').empty().append(deck.generateDeck()).show();
}
function loadDeck() {
	alert(this.innerText);
}
function showSave() {
	$('#SaveBox').slideDown();
}
function hideSave() {
	$('#saveDeckName').removeClass('error');
	$('#SaveBox').slideUp();
}
function saveDeck() {
	var deckName = $('#saveDeckName').val();
	var success = deck.saveCurrent(deckName);
	if( !success ) {
		$('#saveDeckName').addClass('error');
	}
	else {
		$('#saveDeckName').removeClass('error');
		hideSave();
	}
}


$(window).load(function() {
	// Toggle debug mode on if neccessary.
	DEBUG_MODE = ('#debug' == window.location.hash);

window.App_Controller = Backbone.Controller.extend({
	routes: {
		'options': 'showOptions'
	},
  initialize: function(options) {
    _(this).bindAll('showOptions','showDeck');
  },
  showOptions: function() {
    alert('opts');
  },
  showDeck: function() {
    alert('deck');
  }
});

window.app = new App_Controller;

	// Button Bindings
	//$('#showConfig').click(showConfigPanel);
	$('#generateDeck').click(generateDeck);
	$('#showSets').click(showSets);
	$('#saveDeck').click(showSave);

	// Config Window bindings
	$('#ConfigWindow input').change(config.cacheSetting);
	$('.OptionsCancel').click(function() { hideConfigPanel(); });
	$('.OptionsSave').click(function() { hideConfigPanel(true); });
	$('.SetCancel').click(function() { hideSetPanel(); });
	$('.SetSave').click(function() { hideSetPanel(); });

	// Save Box Bindings
	$('#saveDeckCancel').click(hideSave);
	$('#saveDeckCommit').click(saveDeck);

	$('#SetList a').live('click', loadDeck);
	if( DEBUG_MODE ) {
		$('html').width(320).height(480);
		$('#ConfigWindowOptions, #SetWindowList').width(320*.85);
	}

	if( deck.load(deck.LAST_DECK) ) {
		$('#Deck').empty().append(deck.buildDeckHTML()).show();
	}
});
</script>
	</head>
	<body ontouchmove="BlockMove(event);">
		<div id="Main">
			<div id="Buttons">
				<ul>
					<li><a href="#options" class="test">test</a></li>
					<li><button id="generateDeck">New</button></li>
					<li><button id="saveDeck">Save</button></li>
					<li><button id="showSets">List</button</li>
					<li><button id="showConfig">Config</button></li>
				</ul>
			</div>

			<div id="SaveBox">
				<input id="saveDeckName" type="text">
				<button id="saveDeckCancel">Cancel</button>
				<button id="saveDeckCommit">Save</button>
			</div>

			<div id="SetWindow">
				<div id="SetWindowList">
					<div class="SetButtons">
						<button class="SetCancel">Cancel</button>
						<button class="SetSave">Save Current</button>
					</div>
					<div id="NewSet">
						<input type="text" id="newSet_name"/>
					</div>
					<div id="SetList"></div>
				</div>
			</div>
			<div data-role="footer">
				<div data-role="navbar"><ul>
					<li><a href="#home" data-role="button" data-icon="refresh" 
						data-iconpos="top" id="home-newDeck" class="newDeck">New</a></li>
					<li><a href="#decks" data-role="button" data-icon="grid"
						data-iconpos="top" id="home-deckList">List</a></li>
					<li><a href="#options" data-role="button" data-icon="gear"
						data-iconpos="top" id="home-options">Options</a></li>
				</ul></div>
			</div>
		</div>

		<div data-role="page" id="decks">
			<div data-role="header" data-backbtn="false">
				<h1>Saved Decks</h1>
			</div>
			<div data-role="content">
				<ul data-role="listview">
					<li data-role="list-divider">Your Sets</li>
					<li>Set 1</li>
					<li data-role="list-divider">Dominion Sets</li>
					<li>First Game</li>
					<li>Big Money</li>
					<li>Interaction</li>
					<li data-role="list-divider">Intrigue Sets</li>
					<li>Victory Dance</li>
					<li>Secret Schemes</li>
					<li>Best Wishes</li>
				</ul>
			</div>
			<div data-role="footer">
				<div data-role="navbar"><ul>
					<li><a data-role="button" data-icon="refresh" 
						data-iconpos="top" id="deck-newDeck" class="newDeck">New</a></li>
					<li><a href="#decks" data-role="button" data-icon="grid"
						data-iconpos="top" id="deck-deckList" class="ui-btn-active"
						>List</a></li>
					<li><a href="#options" data-role="button" data-icon="gear"
						data-iconpos="top" id="deck-options">Options</a></li>
				</ul></div>
			</div>
		</div>

		<div data-role="page" id="options">
			<div data-role="header" data-backbtn="false">
				<h1>Options</h1>
			</div>
			<div data-role="content">
			<h2>Deck Composition</h2>
			<ul data-role="listview" data-inset="true">
				<li data-role="fieldcontain">
				<label for="deck_requireDefense">Require Defense</label>
				<select name="deck_requireDefense" id="deck_requireDefense"
					data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
				<li data-role="fieldcontain">
				<label for="deck_chooseProsperityBasics">Random Prosperity Basics</label>
				<select name="de
					el: $('k_chooseProsperityBasics" id="deck_chooseProsperityBasics"
					data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
			</ul>

			<h2>Display</h2>
			<ul data-role="listview" data-inset="true">
				<li data-role="fieldcontain">
				<label for="display_Set">Show Set</label>
				<select name="display_Set" id="display_Set" data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
				<li data-role="fieldcontain">
				<label for="display_Cost">Show Cost</label>
				<select name="display_Cost" id="display_Cost" data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
				<li data-role="fieldcontain">
				<label for="display_Type">Show Type</label>
				<select name="display_Type" id="display_Type" data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
			</ul>
			</div>
			<div data-role="footer">
				<div data-role="navbar"><ul>
					<li><a href="#home" data-role="button" data-icon="refresh" 
						data-iconpos="top" id="opt-newDeck" class="newDeck">New</a></li>
					<li><a href="#decks" data-role="button" data-icon="grid"
						data-iconpos="top" id="opt-deckList">List</a></li>
					<li><a href="#options" data-role="button" data-icon="gear"
						data-iconpos="top" id="opt-options" class="ui-btn-active"
						>Options</a></li>
				</ul></div>
		</div>

		<script id="template-options" type="text/x-underscore-template">
			<h2>Deck Composition</h2>
			<ul data-role="listview" data-inset="true">
				<li data-role="fieldcontain">
				<label for="deck_requireDefense">Require Defense</label>
				<select name="deck_requireDefense" id="deck_requireDefense"
					data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
				<li data-role="fieldcontain">
				<label for="deck_chooseProsperityBasics">Random Prosperity Basics</label>
				<select name="de
					el: $('k_chooseProsperityBasics" id="deck_chooseProsperityBasics"
					data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
			</ul>

			<h2>Display</h2>
			<ul data-role="listview" data-inset="true">
				<li data-role="fieldcontain">
				<label for="display_Set">Show Set</label>
				<select name="display_Set" id="display_Set" data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
				<li data-role="fieldcontain">
				<label for="display_Cost">Show Cost</label>
				<select name="display_Cost" id="display_Cost" data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
				<li data-role="fieldcontain">
				<label for="display_Type">Show Type</label>
				<select name="display_Type" id="display_Type" data-role="slider">
					<option value="off">No</option>
					<option value="on">Yes</option>
				</select>
				</li>
			</ul>
		</script>
	</body>
</html>

